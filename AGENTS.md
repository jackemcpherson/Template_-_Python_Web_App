# Repository Guidelines

## Project Structure & Module Organization
This repository is a Copier template for a FastAPI + FastHTML service. Core configuration lives at the root (`pyproject.toml`, `Makefile`, `Dockerfile`, `.github/workflows/ci.yml`). Application code resides under `src/{{ package_name }}/`, keeping imports clean when the package is installed. Shared assets such as templates or static files should sit beside application modules inside that package. Tests mirror the runtime layout in `tests/`, and template defaults include `tests/test_main.py` to illustrate the expected structure.

## Build, Test, and Development Commands
Run `make install` after generation to create the uv-managed virtual environment and sync dependencies. `make run-dev` launches Uvicorn with reload for local iteration. Quality gates are exposed via `make lint` (ruff format + check), `make test` (pytest with coverage reports in `htmlcov/`), and `make security` (bandit scan). Use `make check-all` before pushing to execute the full suite. Container workflows rely on `make docker-build` and `make docker-run` for parity with deployment.

## Coding Style & Naming Conventions
Stick to PEP 8 with 4-space indents and comprehensive type hintsâ€”FastAPI signatures double as request contracts. Package and module names must remain lowercase snake_case to align with the template rendering logic. Formatting and linting are enforced through Ruff; never run `black` or `flake8` separately. Tool configuration is centralized in `pyproject.toml`; extend it there rather than creating ad-hoc config files.

## Testing Guidelines
Write tests with pytest, placing fixtures in `tests/conftest.py` when shared. Name test modules `test_*.py` and functions `test_*` for auto-discovery. Aim to keep coverage above the thresholds configured in `pyproject.toml`; inspect the HTML report generated by `make test` when asserting edge cases. For focused runs use `uv run pytest -k <filter>` to stay inside the managed environment.

## Commit & Pull Request Guidelines
Adopt Conventional Commits (`feat:`, `fix:`, `chore:`) so Copier consumers inherit a readable history. Each PR should summarize scope, link related issues, and note any configuration changes or migrations. Include screenshots or API examples when behavior changes surface responses or HTML. Ensure `make check-all` passes locally before requesting review.

## Security & Configuration Tips
Secrets should enter via environment variables or `.env.local`; never bake credentials into template defaults. Update dependency pins through `uv pip compile` and document any new services in the README to keep downstream projects reproducible.
